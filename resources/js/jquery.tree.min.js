!function(e){e.fn.tree_structure=function(i){var t={add_option:!0,edit_option:!0,delete_option:!0,confirm_before_delete:!0,animate_option:[!0,5],fullwidth_option:!1,align_option:"center",draggable_option:!0};return this.each(function(){i&&e.extend(t,i);var l=t.add_option,s=t.edit_option,n=t.delete_option,d=t.confirm_before_delete,a=t.animate_option,o=t.fullwidth_option,c=t.align_option,r=t.draggable_option,h='<span class="vertical"></span>',m='<span class="horizontal"></span>',f=1==l?'<span class="add_action" title="Click for Add"></span>':"",p=1==s?'<span class="edit_action" title="Click for Edit"></span>':"",v=1==n?'<span class="delete_action" title="Click for Delete"></span>':"",u=e(this).attr("class"),g="pageload";if("center"!=c&&e("."+u+" li").css({"text-align":c}),o){var _,b,C=0;e("."+u+" li li").each(function(){var i=e(this).width();(0==C||i>_)&&(_=e(this).width(),b=e(this)),C++});var k=b.closest("ul").children("li").eq(0).nextAll().length,w=parseInt(0);for($i=0;$i<=k;$i++)w+=parseInt(b.closest("ul").children("li").eq($i).width());e("."+u).closest("div").width(w)}function x(e){e.prepend(h+m).children("div").prepend(f+v+p),0!=e.children("ul").length&&(e.hasClass("thide")?e.children("div").prepend('<b class="thide tshow"></b>'):e.children("div").prepend('<b class="thide"></b>'))}function z(i){var t=e("."+u).offset().left;t=parseInt(t,10);var l=i.children("div").outerWidth(!0)/2,s=i.children("div").offset().left;if(null!=i.parents("li").offset())var n=i.parents("li").offset().top;if(vertical_height=i.offset().top-n-i.parents("li").children("div").outerHeight(!0)/2,i.children("span.vertical").css({height:vertical_height,"margin-top":-vertical_height,"margin-left":l,left:s-t}),null==i.parents("li").offset())var d=0;else d=i.parents("li").children("div").offset().left+i.parents("li").children("div").width()/2-(s+i.children("div").width()/2);var a=d<0?-Math.abs(d)+l:l;i.children("span.horizontal").css({width:Math.abs(d),"margin-top":-vertical_height,"margin-left":a,left:s-t})}if(e("."+u+" li.thide").each(function(){e(this).children("ul").hide()}),1==a[0]){var y=e("."+u+" li").length;C=0}function H(){e("."+u+" li").each(function(){"pageload"==g&&x(e(this)),z(e(this))})}if(a[0]?$timeout=setInterval(function(){x(e("."+u+" li").eq(C)),z(e("."+u+" li").eq(C)),++C==y&&(C=0,clearInterval($timeout))},a[1]):H(),g="others",e(window).resize(function(){H()}),e(document).on("click","."+u+" b.thide",function(){e(this).toggleClass("tshow"),e(this).closest("li").toggleClass("thide").children("ul").toggle(),H()}),e(document).on("mouseenter mouseleave","."+u+" li > div",function(i){"mouseenter"==i.type||"mouseover"==i.type?(e("."+u+" li > div.current").removeClass("current"),e("."+u+" li > div.children").removeClass("children"),e("."+u+" li > div.parent").removeClass("parent"),e(this).addClass("current"),e(this).closest("li").children("ul").children("li").children("div").addClass("children"),e(this).closest("li").closest("ul").closest("li").children("div").addClass("parent"),e(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").show()):e(this).children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide()}),e(document).on("click","."+u+" span.highlight",function(){e("."+u+" li.highlight").removeClass("highlight"),e("."+u+" li > div.parent").removeClass("parent"),e("."+u+" li > div.children").removeClass("children"),e(this).closest("li").addClass("highlight"),e(".highlight li > div").addClass("children"),function e(i){if(i.length>0)return i.children("div").addClass("parent"),i=i.closest("li").closest("ul").closest("li"),e(i)}(e(this).closest("li").closest("ul").closest("li"))}),e(document).on("click","."+u+" span.highlight",function(){o&&e("."+u).parent("div").parent("div").scrollLeft(0),e("."+u+" li > div").not(".parent, .current, .children").closest("li").addClass("tnone"),e("."+u+" li div b.thide.tshow").closest("div").closest("li").children("ul").addClass("tshow"),e("."+u+" li div b.thide").addClass("tnone"),0==e(".back_btn").length&&e("body").prepend('<img src="images/back.png" class="back_btn" />'),H(),e(".back_btn").click(function(){e("."+u+" ul.tshow").removeClass("tshow"),e("."+u+" li.tnone").removeClass("tnone"),e("."+u+" li div b.thide").removeClass("tnone"),e(this).remove(),H()})}),l&&e(document).on("click","."+u+" span.add_action",function(){e("form.add_data").length>0&&e("form.add_data").remove(),e("form.edit_data").length>0&&e("form.edit_data").remove();var i=e(this);if(0==i.closest("div").children("form.add_data").length){i.parent("div").append('<form class="add_data" method="post" action=""><img class="close" src="images/close.png" /><input type="text" class="first_name" name="first_name" placeholder="first name"><input type="checkbox" name="showhideval" id="hide" /><label for="hide">Hide Child Nodes</label><input type="submit" class="submit" name="submit" value="Submit"></form>'),i.closest("div").children("form").offset().top+i.closest("div").children("form").outerHeight()>e(window).height()&&i.closest("div").children("form").css({"margin-top":-i.closest("div").children("form").outerHeight()}),i.closest("div").children("form").offset().left+i.closest("div").children("form").outerWidth()>e(window).width()&&i.closest("div").children("form").css({"margin-left":-i.closest("div").children("form").outerWidth()}),i.closest("div").children("form").children("input.first_name").focus(),i.closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex")}e(document).on("click","input.submit",function(i){var t=e(this);i.preventDefault();t.closest("div").attr("id");t.closest("li").before("<img src='images/load.gif' class='load' />"),e(document).off("click","input.submit");var l="<li>"+h+m+'<div id="12345"><span class="highlight" title="Click for Highlight | dblClick"></span>'+f+v+p+"<span class='first_name'>"+t.closest("form").find("input.first_name").val()+"</span></div></li>";t.closest("li").children("ul").length>0?t.closest("li").children("ul").append(l):t.closest("li").append("<ul>"+l+"</ul>"),t.closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),t.closest("form.add_data").remove(),e("li > div.zindex").removeClass("zindex"),H(),j(),e("img.load").remove()}),e(document).on("click","img.close",function(){e(this).closest("form.add_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e(this).closest("form.add_data").remove(),e("li > div.zindex").removeClass("zindex")})}),s&&e(document).on("click","."+u+" span.edit_action",function(){e("form.add_data").length>0&&e("form.add_data").remove(),e("form.edit_data").length>0&&e("form.edit_data").remove();var i=e(this).closest("div").clone();i.children("span.highlight").length>0&&i.children("span.highlight").remove(),i.children("span.delete_action").length>0&&i.children("span.delete_action").remove(),i.children("span.add_action").length>0&&i.children("span.add_action").remove(),i.children("span.edit_action").length>0&&i.children("span.edit_action").remove(),i.children("b.thide").length>0&&i.children("b.thide").remove();e(this).closest("li").hasClass("thide"),e(this).closest("div").attr("id");var t=e(this);0==t.closest("div").children("form.edit_data").length&&(t.closest("div").append('<form class="edit_data" method="post" action=""><img class="close" src="images/close.png" /><input type="text" class="first_name" name="first_name" value="" placeholder="first name"><input type="checkbox"  value="" name="showhideval" id="hide" /><label for="hide">Hide Child Nodes</label><input type="submit" class="edit" name="submit" value="submit"></form>'),t.closest("div").children("form").offset().top+t.closest("div").children("form").outerHeight()>e(window).height()&&t.closest("div").children("form").css({"margin-top":-t.closest("div").children("form").outerHeight()}),t.closest("div").children("form").offset().left+t.closest("div").children("form").outerWidth()>e(window).width()&&t.closest("div").children("form").css({"margin-left":-t.closest("div").children("form").outerWidth()}),t.closest("div").children("form").children("input.first_name").select(),t.closest("div").closest("li").closest("ul").children("li").children("div").addClass("zindex")),e(document).on("click","input.edit",function(i){var t=e(this);i.preventDefault(),t.closest("li").before("<img src='images/load.gif' class='load' />"),e(document).off("click","input.edit"),t.closest("form").find("input:checked").length>0?0==t.closest("li").hasClass("thide")&&t.closest("div").find("b.thide").trigger("click"):t.closest("li").hasClass("thide")&&t.closest("div").find("b.thide").trigger("click");var l=t.closest("form.edit_data").closest("div"),s="";s+="<span class='first_name'>"+t.closest("form").find("input.first_name").val()+"</span>",l.children("span.edit_action").nextAll().remove(),l.text().length>0&&l.html(l.html().replace(l.text(),"")),l.append(s),l.children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e("li > div.zindex").removeClass("zindex"),H(),e("img.load").remove()}),e(document).on("click","img.close",function(){e(this).closest("form.edit_data").closest("div").children("span.highlight, span.add_action, span.delete_action, span.edit_action").hide(),e(this).closest("form.edit_data").remove(),e("li > div.zindex").removeClass("zindex")})}),n&&e(document).on("click","."+u+" span.delete_action",function(){var i=e(this),t=e(this).closest("li").closest("ul").closest("li");if(confirm_message=1,d){var l=0===e(this).closest("li").children("ul").length?"Deleat This ?":"Deleat This with\nAll Child Element ?";confirm_message=confirm(l)}1==e(this).closest("div").attr("id")?alert("You cant delete root person"):confirm_message&&(e(this).closest("li").addClass("ajax_delete_all"),ajax_delete_id=Array(),ajax_delete_id.push(e(this).closest("div").attr("id")),e(".ajax_delete_all li").each(function(){ajax_delete_id.push(e(this).children("div").attr("id"))}),e(this).closest("li").removeClass("ajax_delete_all"),e(this).closest("li").before("<img src='images/load.gif' class='load' />"),e("img.load").remove(),i.closest("li").fadeOut().remove(),H(),0==t.children("ul").children("li").length&&t.children("ul").remove())}),r){function j(){D(),e("."+u+" li > div").draggable({cursor:"move",distance:40,zIndex:5,revert:!0,revertDuration:100,snap:".tree li div",snapMode:"inner",start:function(i,t){e("li.li_children").removeClass("li_children"),e(this).closest("li").addClass("li_children")},stop:function(e,i){D()}})}function D(){e("."+u+" li > div").droppable({accept:".tree li div",drop:function(i,t){e("div.check_div").removeClass("check_div"),e(".li_children div").addClass("check_div"),e(this).hasClass("check_div")?alert("Cant Move on Child Element."):(0==e(this).next("ul").length?e(this).after("<ul><li>"+e(t.draggable[0]).attr({style:""}).closest("li").html()+"</li></ul>"):e(this).next("ul").append("<li>"+e(t.draggable[0]).attr({style:""}).closest("li").html()+"</li>"),1==e(t.draggable[0]).closest("ul").children("li").length?e(t.draggable[0]).closest("ul").remove():e(t.draggable[0]).closest("li").remove(),H(),j())}})}j()}})}}(jQuery);